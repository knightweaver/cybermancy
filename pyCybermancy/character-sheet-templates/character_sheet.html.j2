<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Character Sheet – {{ name }}</title>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 1rem;
    }
    .character-sheet {
      max-width: 900px;
      margin: 0 auto;
      background: #ffffff;
      padding: 1.5rem 2rem;
      border-radius: 8px;
      box-shadow: 0 0 6px rgba(0,0,0,0.1);
    }
    .sheet-header {
      display: flex;
      gap: 1.5rem;
      align-items: flex-start;
      border-bottom: 1px solid #ddd;
      padding-bottom: 1rem;
      margin-bottom: 1rem;
    }
    .char-portrait {
      width: 140px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #ccc;
      background: #eee;
    }
    .identity h1 {
      margin: 0 0 0.25rem;
      font-size: 1.6rem;
    }
    .identity .tags {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 0.25rem;
    }
    .identity .meta {
      font-size: 0.9rem;
      color: #333;
    }
    .grid-2 {
      display: grid;
      grid-template-columns: 1.2fr 1.2fr;
      gap: 1rem;
    }
    .box {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      font-size: 0.9rem;
    }
    .box h2 {
      font-size: 1rem;
      margin: 0 0 0.35rem;
      border-bottom: 1px solid #eee;
      padding-bottom: 0.25rem;
    }
    .traits-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    .traits-table th,
    .traits-table td {
      border: 1px solid #ddd;
      padding: 0.2rem 0.4rem;
      text-align: center;
    }
    .traits-table th {
      background: #f0f0f0;
    }
    .list {
      margin: 0;
      padding-left: 1.1rem;
      font-size: 0.9rem;
    }
    .list li {
      margin-bottom: 0.25rem;
    }
    .section {
      margin-top: 1rem;
    }
    .section h2 {
      font-size: 1.1rem;
      margin: 0 0 0.35rem;
      border-bottom: 1px solid #ddd;
      padding-bottom: 0.25rem;
    }
    .subsection-title {
      font-weight: 600;
      margin-top: 0.5rem;
      margin-bottom: 0.2rem;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }
    table.simple {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    table.simple th,
    table.simple td {
      border: 1px solid #ddd;
      padding: 0.25rem 0.35rem;
    }
    table.simple th {
      background: #c42929;
      text-align: left;
    }
    .bio {
      font-size: 0.9rem;
      line-height: 1.4;
    }
  </style>
</head>

<body>
<div class="character-sheet">

  <!-- HEADER -->
  <div class="sheet-header">
    <img class="char-portrait" src="{{ img }}" alt="{{ name }} portrait" />

    <div class="identity">
      <h1>{{ name }}</h1>

      <div class="tags">
        Heritage: {{ heritage_name }} • Community: {{ community_name }}
      </div>

      <div class="tags">
        Class: {{ class_name }} • Subclass: {{ subclass_name }}
      </div>

      <div class="meta">
        Level {{ level }} • Proficiency: +{{ proficiency }}
        • Evasion: {{ evasion }} • Armor: {{ armor }}
      </div>

      <div class="meta">
        HP: {{ hp_current }} / {{ hp_max }}
        • Stress: {{ stress_current }} / {{ stress_max }}
        • Hope: {{ hope_current }} / {{ hope_max }}
      </div>
    </div>
  </div>


  <!-- CORE TRAITS -->
  <div class="grid-2">
    <div class="box">
      <h2>Traits</h2>
      <table class="traits-table">
        <tr>
          <th>Strength</th>
          <th>Agility</th>
          <th>Finesse</th>
          <th>Instinct</th>
          <th>Presence</th>
          <th>Knowledge</th>
        </tr>
        <tr>
          <td>{{ traits.strength }}</td>
          <td>{{ traits.agility }}</td>
          <td>{{ traits.finesse }}</td>
          <td>{{ traits.instinct }}</td>
          <td>{{ traits.presence }}</td>
          <td>{{ traits.knowledge }}</td>
        </tr>
      </table>
    </div>

    <div class="box">
      <h2>Defense & Resources</h2>

      <div>
        Major Threshold: {{ thresholds.major }} • Severe: {{ thresholds.severe }}
      </div>

      <div style="margin-top:0.25rem;">
        Resistances:<br />
        Physical: {{ resistances.physical }} • Magical: {{ resistances.magical }}
      </div>

      <div style="margin-top:0.5rem;">
        Gold:
        {{ gold.coins }} coins •
        {{ gold.handfuls }} handfuls •
        {{ gold.bags }} bags •
        {{ gold.chests }} chests
      </div>
    </div>
  </div>


  <!-- EXPERIENCES -->
  <div class="section">
    <h2>Experiences</h2>
    <ul class="list">
      {% for exp in experiences %}
      <li><strong>{{ exp.name }}</strong> ({{ exp.value }}): {{ exp.description }}</li>
      {% endfor %}
    </ul>
  </div>


  <!-- FEATURES -->
  <div class="section">
    <h2>Features</h2>

    {% for group in ["ancestry", "community", "class", "subclass"] %}
      <div class="subsection-title">{{ group|title }}</div>
      <ul class="list">
        {% for item in features[group] %}
        <li>
          <strong>{{ item.name }}</strong> – {{ item.description | safe }}
        </li>
        {% endfor %}
      </ul>
    {% endfor %}
  </div>


  <!-- DOMAINS -->
  <div class="section">
    <h2>Domain Abilities</h2>

    <table class="simple">
      <thead>
        <tr>
          <th>Name</th>
          <th>Domain</th>
          <th>Level</th>
          <th>Text</th>
        </tr>
      </thead>
      <tbody>
        {% for card in domain_cards %}
        <tr>
          <td>{{ card.name }}</td>
          <td>{{ card.domain }}</td>
          <td>{{ card.level }}</td>
          <td>{{ card.description | safe }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>


  <!-- WEAPONS -->
  <div class="section">
    <h2>Weapons</h2>

    <table class="simple">
      <thead>
        <tr>
          <th>Name</th>
          <th>Equipped</th>
          <th>Trait & Range</th>
          <th>Damage</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        {% for w in weapons %}
        <tr>
          <td>{{ w.name }}</td>
          <td>{{ "Yes" if w.equipped else "No" }}</td>
          <td>{{ w.trait }} • {{ w.range }}</td>
          <td>{{ w.damage }}</td>
          <td>
            {% for a in w.actions %}
              <strong>{{ a.name }}</strong> – {{ a.description | safe }}<br />
            {% endfor %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>


  <!-- ARMOR & GEAR -->
  <div class="section">
    <h2>Armor & Gear</h2>

    <div class="subsection-title">Armor</div>
    <ul class="list">
      {% for a in armor_items %}
      <li>
        <strong>{{ a.name }}</strong>
        (Equipped: {{ "Yes" if a.equipped else "No" }})<br />
        Base: {{ a.base }} • Major {{ a.major }} • Severe {{ a.severe }}<br />
        {{ a.description }}
      </li>
      {% endfor %}
    </ul>

    <div class="subsection-title">Consumables</div>
    <ul class="list">
      {% for c in consumables %}
      <li>
        <strong>{{ c.name }}</strong> (x{{ c.qty }})<br />
        {{ c.description | safe }}
      </li>
      {% endfor %}
    </ul>

    <div class="subsection-title">Other Gear</div>
    <ul class="list">
      {% for g in gear %}
      <li>
        <strong>{{ g.name }}</strong> (x{{ g.qty }})<br />
        {{ g.description }}
      </li>
      {% endfor %}
    </ul>
  </div>


  <!-- BIOGRAPHY -->
  <div class="section">
    <h2>Background</h2>
    <div class="bio">
      {{ biography | safe }}
    </div>
  </div>

</div>
</body>
</html>
